const LogoIcon = (props) => (
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="none" {...props}>
    <rect x="5" y="5" width="90" height="90" rx="20" fill="currentColor" opacity="0.2" stroke="currentColor"
        strokeWidth="4" />
    <text x="50" y="65" fontSize="50" fontWeight="900" fill="currentColor" textAnchor="middle" fontFamily="sans-serif"
        style={{ fontStyle: 'italic' }}>6-7</text>
</svg>
);

const Trophy = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
    <path d="M4 22h16" />
    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
</svg>);
const CheckCircle2 = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
    <circle cx="12" cy="12" r="10" />
    <path d="m9 12 2 2 4-4" />
</svg>);
const XCircle = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
    <circle cx="12" cy="12" r="10" />
    <path d="m15 9-6 6" />
    <path d="m9 9 6 6" />
</svg>);
const ArrowRight = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
    <path d="M5 12h14" />
    <path d="m12 5 7 7-7 7" />
</svg>);
const RefreshCw = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
    <path d="M21 3v5h-5" />
    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
    <path d="M8 21H3v-5" />
</svg>);
const getPoints = (rank) => {
if (rank === 1) return 5;
if (rank === 2) return 4;
if (rank === 3) return 3;
if (rank === 4) return 2;
if (rank === 5) return 1;
if (rank === 6 || rank === 7) return 0; // The goal
return 10; // 8, 9, 10 or miss
};

const getFeedback = (rank) => {
if (rank === 1) return "The Top Answer! (+5 Points)";
if (rank === 2) return "Runner Up! (+4 Points)";
if (rank === 3) return "Bronze Medal position. (+3 Points)";
if (rank === 4) return "Too popular! (+2 Points)";
if (rank === 5) return "Just on the edge... (+1 Point)";
if (rank === 6) return "PERFECT! The Sweet Spot! (0 Points)";
if (rank === 7) return "PERFECT! The Sweet Spot! (0 Points)";
if (rank > 7 && rank <= 10) return "Too obscure! It's on the list, but too low. (+10 Points)" ;
    return "Missed! Not in the top 10. (+10 Points)" ; }; // --- Daily Logic & Seeding --- // Simple PRNG to get
    deterministic "random" numbers from a date seed const mulberry32=(a)=> {
    return function () {
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
    }

    const getDailyRounds = () => {
    const todayStr = new Date().toDateString(); // "Fri Oct 27 2023"
    // Create a seed from the date string
    let seed = 0;
    for (let i = 0; i < todayStr.length; i++) { seed +=todayStr.charCodeAt(i); } const rand=mulberry32(seed); // Pick 3
        rounds for the day // We use a Set to ensure we don't pick the same round twice if array is small const
        indices=new Set(); const roundsToPick=Math.min(3, ALL_CATEGORIES.length); // Loop until we have enough unique
        rounds // (Note: In a real app with many categories, this is fine. With only 5, it rotates quickly) let
        safety=0; while (indices.size < roundsToPick && safety < 100) { const idx=Math.floor(rand() *
        ALL_CATEGORIES.length); indices.add(idx); safety++; } return Array.from(indices).map(idx=> ALL_CATEGORIES[idx]);
        };

        const getSecondsToTomorrow = () => {
        const now = new Date();
        const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        return Math.floor((tomorrow - now) / 1000);
        };

        const formatTime = (seconds) => {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        };

        // --- Components ---

        const App = () => {
        const [gameState, setGameState] = useState('loading'); // loading, start, playing, result, summary
        const [rounds, setRounds] = useState([]);
        const [roundIndex, setRoundIndex] = useState(0);
        const [totalScore, setTotalScore] = useState(0);
        const [input, setInput] = useState('');
        const [roundResult, setRoundResult] = useState(null);
        const [scoreHistory, setScoreHistory] = useState([]); // Array of scores per round
        const [copied, setCopied] = useState(false);
        const [timeUntilNext, setTimeUntilNext] = useState(getSecondsToTomorrow());

        // Initialize Daily Game
        useEffect(() => {
        const todayStr = new Date().toDateString();
        const dailyRounds = getDailyRounds();
        setRounds(dailyRounds);

        // Check LocalStorage
        const savedState = localStorage.getItem('sixSevenState');
        if (savedState) {
        const parsed = JSON.parse(savedState);
        if (parsed.date === todayStr) {
        // Restore today's progress
        setTotalScore(parsed.totalScore);
        setScoreHistory(parsed.scoreHistory);
        setRoundIndex(parsed.roundIndex);

        if (parsed.isComplete) {
        setGameState('summary');
        } else if (parsed.roundResult) {
        // They refreshed on the result screen
        setRoundResult(parsed.roundResult);
        setGameState('result');
        } else {
        // Mid-game but clean slate for current round
        setGameState('playing');
        }
        } else {
        // New day, reset storage
        localStorage.removeItem('sixSevenState');
        setGameState('start');
        }
        } else {
        setGameState('start');
        }
        }, []);

        // Countdown Timer
        useEffect(() => {
        if (gameState === 'summary') {
        const timer = setInterval(() => {
        setTimeUntilNext(getSecondsToTomorrow());
        }, 1000);
        return () => clearInterval(timer);
        }
        }, [gameState]);

        const saveState = (newState) => {
        const todayStr = new Date().toDateString();
        const stateToSave = {
        date: todayStr,
        totalScore: newState.totalScore !== undefined ? newState.totalScore : totalScore,
        roundIndex: newState.roundIndex !== undefined ? newState.roundIndex : roundIndex,
        scoreHistory: newState.scoreHistory !== undefined ? newState.scoreHistory : scoreHistory,
        isComplete: newState.isComplete || false,
        roundResult: newState.roundResult // can be null
        };
        localStorage.setItem('sixSevenState', JSON.stringify(stateToSave));
        };

        const handleStartGame = () => {
        setGameState('playing');
        setRoundIndex(0);
        setTotalScore(0);
        setScoreHistory([]);
        saveState({ totalScore: 0, roundIndex: 0, scoreHistory: [], roundResult: null });
        };

        const handleSubmit = (e) => {
        e.preventDefault();
        if (!input.trim()) return;

        const currentRoundData = rounds[roundIndex];
        const normalizedInput = normalize(input);

        // Find match
        let matchedRank = -1;
        let matchedName = "";

        for (let item of currentRoundData.data) {
        if (item.aliases.some(alias => normalize(alias) === normalizedInput)) {
        matchedRank = item.rank;
        matchedName = item.name;
        break;
        }
        }

        const points = matchedRank === -1 ? 10 : getPoints(matchedRank);

        const newScore = totalScore + points;
        const newHistory = [...scoreHistory, points];

        const resultData = {
        guess: input,
        rank: matchedRank,
        matchedName: matchedName,
        points: points,
        feedback: getFeedback(matchedRank)
        };

        setTotalScore(newScore);
        setScoreHistory(newHistory);
        setRoundResult(resultData);
        setGameState('result');

        saveState({
        totalScore: newScore,
        scoreHistory: newHistory,
        roundResult: resultData
        });
        };

        const handleNextRound = () => {
        if (roundIndex < rounds.length - 1) { const nextIndex=roundIndex + 1; setRoundIndex(nextIndex);
            setGameState('playing'); setRoundResult(null); setInput(''); saveState({ roundIndex: nextIndex, roundResult:
            null }); } else { setGameState('summary'); saveState({ isComplete: true, roundResult: null }); } }; const
            handleShare=()=> {
            const todayStr = new Date().toLocaleDateString();
            const boxes = scoreHistory.map(s => {
            if (s === 0) return 'ðŸŸ©'; // Perfect
            if (s <= 5) return 'ðŸŸ¨' ; // Okay return 'ðŸŸ¥' ; // Bad }).join(''); const text=`6-7 Daily
                ${todayStr}\nScore: ${totalScore}\n${boxes}\n\nCan you beat the sweet spot?`; // Fallback for
                iframe/sandboxed environments const textArea=document.createElement("textarea"); textArea.value=text;
                textArea.style.position="fixed" ; // Avoid scrolling to bottom textArea.style.left="-9999px" ;
                document.body.appendChild(textArea); textArea.focus(); textArea.select(); try {
                document.execCommand('copy'); setCopied(true); setTimeout(()=> setCopied(false), 2000);
                } catch (err) {
                console.error('Failed to copy', err);
                }

                document.body.removeChild(textArea);
                };

                if (gameState === 'loading') return <div
                    className="min-h-screen bg-slate-900 flex items-center justify-center text-white">Loading...</div>;

                const currentRoundData = rounds[roundIndex];

                return (
                <div
                    className="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-slate-900 to-slate-800">
                    <div
                        className="w-full max-w-2xl bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">

                        {/* Header */}
                        <div
                            className="bg-slate-950 p-6 flex justify-between items-center border-b border-slate-800 shrink-0">
                            <div className="flex items-center gap-3">
                                <div
                                    className="bg-indigo-600 p-2 rounded-lg text-white w-12 h-12 flex items-center justify-center">
                                    <LogoIcon className="w-full h-full" />
                                </div>
                                <div>
                                    <h1
                                        className="text-3xl font-fun font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400">
                                        6-7
                                    </h1>
                                    <span
                                        className="text-[10px] text-indigo-400 font-bold tracking-widest uppercase block -mt-1">Daily
                                        Challenge</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-4 text-sm font-mono">
                                {gameState !== 'start' && gameState !== 'summary' && (
                                <>
                                    <div className="text-slate-400 hidden sm:block">ROUND {roundIndex +
                                        1}/{rounds.length}</div>
                                    <div className="bg-slate-800 px-3 py-1 rounded text-indigo-400 font-bold">SCORE:
                                        {totalScore}</div>
                                </>
                                )}
                            </div>
                        </div>

                        {/* Content Area */}
                        <div className="p-6 md:p-8 flex-1 overflow-y-auto flex flex-col relative">

                            {gameState === 'start' && (
                            <div
                                className="flex flex-col items-center justify-center text-center space-y-8 py-4 fade-in">
                                <div className="space-y-4 max-w-md">
                                    <h2 className="text-3xl font-fun text-white">The Daily Sweet Spot</h2>
                                    <p className="text-slate-400">
                                        3 rounds per day. Everyone plays the same categories.
                                        Your goal: Guess items ranked <span
                                            className="text-green-400 font-bold">6th</span> or <span
                                            className="text-green-400 font-bold">7th</span>.
                                    </p>
                                </div>

                                <div
                                    className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full text-left bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                    <div>
                                        <h3 className="font-bold text-white mb-2 flex items-center gap-2">
                                            <Trophy className="w-4 h-4 text-yellow-500" /> High Ranks (1-5)
                                        </h3>
                                        <ul className="text-xs mt-2 space-y-1 text-slate-500 font-mono">
                                            <li>Rank 1: +5 pts</li>
                                            <li>Rank 5: +1 pts</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-white mb-2 flex items-center gap-2">
                                            <CheckCircle2 className="w-4 h-4 text-green-500" /> Sweet Spot (6-7)
                                        </h3>
                                        <ul className="text-xs mt-2 space-y-1 text-slate-500 font-mono">
                                            <li>Rank 6: 0 pts</li>
                                            <li>Rank 7: 0 pts</li>
                                        </ul>
                                    </div>
                                </div>

                                <button onClick={handleStartGame}
                                    className="bg-indigo-600 hover:bg-indigo-500 text-white text-lg font-bold py-4 px-12 rounded-full transition-all transform hover:scale-105 shadow-lg shadow-indigo-900/50 flex items-center gap-2">
                                    Start Daily Challenge
                                    <ArrowRight className="w-5 h-5" />
                                </button>
                            </div>
                            )}

                            {gameState === 'playing' && (
                            <div className="flex flex-col h-full fade-in">
                                <div className="space-y-6 flex-1">
                                    <div>
                                        <div
                                            className="text-xs font-bold text-indigo-500 mb-2 uppercase tracking-widest">
                                            Round {roundIndex + 1} of {rounds.length}</div>
                                        <h2 className="text-2xl font-bold text-white mb-2 font-fun tracking-wide">
                                            {currentRoundData.category}</h2>
                                        <p className="text-slate-400">{currentRoundData.description}</p>
                                    </div>

                                    <form onSubmit={handleSubmit} className="relative mt-8">
                                        <input type="text" value={input} onChange={(e)=> setInput(e.target.value)}
                                        className="w-full bg-slate-800 border-2 border-slate-700 focus:border-indigo-500
                                        text-white text-xl p-4 rounded-xl outline-none transition-colors
                                        placeholder:text-slate-600"
                                        placeholder="Type your answer..."
                                        autoFocus
                                        />
                                        <button type="submit" disabled={!input.trim()}
                                            className="absolute right-2 top-2 bottom-2 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:hover:bg-indigo-600 text-white px-6 rounded-lg font-bold transition-colors">
                                            Submit
                                        </button>
                                    </form>
                                </div>
                                <div className="mt-auto pt-8">
                                    <div
                                        className="bg-indigo-900/20 border border-indigo-500/30 p-4 rounded-lg flex items-start gap-3">
                                        <HelpCircle className="w-5 h-5 text-indigo-400 shrink-0 mt-0.5" />
                                        <p className="text-sm text-indigo-200">
                                            Tip: Aim for the middle of the list. Not the most obvious, but not obscure.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            )}

                            {gameState === 'result' && (
                            <div className="flex flex-col h-full fade-in space-y-6">
                                {/* Result Banner */}
                                <div className={`p-4 rounded-xl border-l-4 shadow-lg shrink-0 ${roundResult.points===0
                                    ? 'bg-green-900/30 border-green-500' : roundResult.points <=5
                                    ? 'bg-yellow-900/30 border-yellow-500' : 'bg-red-900/30 border-red-500' }`}>
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <div className="text-sm uppercase tracking-wider font-bold mb-1 opacity-70">
                                                {roundResult.points === 0 ? 'Excellent!' : roundResult.points <= 5
                                                    ? 'Close!' : 'Ouch!' } </div>
                                                    <div className="text-xl font-bold text-white">
                                                        You guessed: <span
                                                            className="text-indigo-300">"{roundResult.guess}"</span>
                                                    </div>
                                                    <div className="text-slate-300 mt-1">{roundResult.feedback}</div>
                                            </div>
                                            <div className="text-4xl font-mono font-bold">
                                                +{roundResult.points}
                                            </div>
                                        </div>
                                    </div>

                                    {/* The List Reveal */}
                                    <div className="flex-1 overflow-hidden flex flex-col min-h-0">
                                        <h3
                                            className="text-sm font-bold text-slate-500 uppercase tracking-widest mb-3 shrink-0">
                                            The Full List</h3>
                                        <div className="flex-1 overflow-y-auto pr-2 space-y-2 min-h-0">
                                            {currentRoundData.data.map((item, idx) => {
                                            const isTarget = idx === 5 || idx === 6;
                                            const isUserMatch = item.rank === roundResult.rank;

                                            return (
                                            <div key={idx} style={{ animationDelay: `${idx * 50}ms` }}
                                                className={`list-item-enter flex items-center justify-between p-3
                                                rounded-lg border ${isUserMatch
                                                ? 'bg-indigo-600 border-indigo-400 ring-2 ring-indigo-400/50 z-10' :
                                                isTarget ? 'bg-green-900/20 border-green-500/50'
                                                : 'bg-slate-800 border-slate-700 opacity-60' }`}>
                                                <div className="flex items-center gap-4">
                                                    <span className={`mono font-bold w-8 text-center ${isTarget
                                                        ? 'text-green-400' : 'text-slate-500' }`}>#{item.rank}</span>
                                                    <span className={`font-medium ${isUserMatch ? 'text-white'
                                                        : 'text-slate-300' }`}>{item.name}</span>
                                                </div>
                                                <div
                                                    className="text-xs font-mono font-bold px-2 py-1 rounded bg-black/20">
                                                    {getPoints(item.rank) === 0 ? '0 PTS' : `+${getPoints(item.rank)}`}
                                                </div>
                                            </div>
                                            )
                                            })}
                                        </div>
                                    </div>

                                    <button onClick={handleNextRound}
                                        className="shrink-0 w-full bg-white text-slate-900 hover:bg-slate-200 font-bold py-3 rounded-xl transition-colors flex items-center justify-center gap-2">
                                        {roundIndex
                                        < rounds.length - 1 ? 'Next Round' : 'See Daily Summary' } <ArrowRight
                                            className="w-5 h-5" />
                                    </button>
                                </div>
                                )}

                                {gameState === 'summary' && (
                                <div
                                    className="flex flex-col items-center justify-center text-center space-y-6 py-4 fade-in h-full">
                                    <div className="text-slate-400 uppercase tracking-widest text-sm font-bold">Daily
                                        Challenge Complete</div>

                                    <div
                                        className="bg-slate-800 p-8 rounded-2xl border border-slate-700 min-w-[200px] shadow-xl">
                                        <div className="text-sm text-slate-400 uppercase tracking-widest mb-2">Total
                                            Score</div>
                                        <div className={`text-6xl font-mono font-bold ${totalScore===0
                                            ? 'text-green-400' : totalScore < 15 ? 'text-white' : 'text-red-400' }`}>
                                            {totalScore}
                                        </div>
                                    </div>

                                    {/* Score Breakdown Visualization */}
                                    <div className="flex gap-2">
                                        {scoreHistory.map((score, idx) => (
                                        <div key={idx} className="flex flex-col items-center gap-1">
                                            <div className={`w-12 h-12 rounded-lg flex items-center justify-center
                                                text-xl font-bold border-2 ${score===0
                                                ? 'bg-green-900/40 border-green-500 text-green-400' : score <=5
                                                ? 'bg-yellow-900/40 border-yellow-500 text-yellow-400'
                                                : 'bg-red-900/40 border-red-500 text-red-400' }`}>
                                                {score}
                                            </div>
                                            <span className="text-[10px] text-slate-500 uppercase">R{idx + 1}</span>
                                        </div>
                                        ))}
                                    </div>

                                    <div className="text-lg font-medium text-indigo-300 max-w-sm">
                                        {totalScore === 0 ? "You are the master of the sweet spot!" :
                                        totalScore <= 10 ? "Incredible knowledge of the obscure."
                                            : "Come back tomorrow to try again!" } </div>

                                            <div className="w-full h-px bg-slate-800 my-4"></div>

                                            <div className="grid grid-cols-2 gap-4 w-full max-w-sm">
                                                <div
                                                    className="bg-slate-950 p-4 rounded-xl flex flex-col items-center justify-center border border-slate-800">
                                                    <div className="text-xs text-slate-500 mb-1 uppercase font-bold">
                                                        Next Game</div>
                                                    <div
                                                        className="flex items-center gap-2 text-xl font-mono text-white">
                                                        <Clock className="w-4 h-4 text-indigo-500" />
                                                        {formatTime(timeUntilNext)}
                                                    </div>
                                                </div>
                                                <button onClick={handleShare} className={`p-4 rounded-xl flex flex-col
                                                    items-center justify-center border transition-all ${copied
                                                    ? 'bg-green-600 border-green-500 text-white'
                                                    : 'bg-indigo-600 border-indigo-500 text-white hover:bg-indigo-500'
                                                    }`}>
                                                    <div className="text-xs mb-1 uppercase font-bold opacity-80">{copied
                                                        ? 'Copied!' : 'Share Result'}</div>
                                                    <div className="flex items-center gap-2 text-xl font-bold">
                                                        <Share2 className="w-5 h-5" />
                                                        {copied ? 'Success' : 'Share'}
                                                    </div>
                                                </button>
                                            </div>
                                    </div>
                                    )}

                                </div>
                            </div>

                            {/* Footer */}
                            <div className="mt-8 text-slate-500 text-xs text-center max-w-lg">
                                <p>6-7 Daily. New rounds every midnight.</p>
                            </div>
                        </div>
                        );
                        };

                        const root = ReactDOM.createRoot(document.getElementById('root'));
                        root.render(
                        <App />);
                        </script>
                        </body>

                        </html>